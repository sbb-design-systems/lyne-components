name: Build Start
on:
  workflow_run:
    workflows: [Build]
    types: [requested]

jobs:
  remove-label:
    runs-on: ubuntu-slim
    if: github.event_name == 'pull_request'
    permissions:
      pull-requests: write
    steps:
      - name: "Remove 'preview-available' label"
        # This label is used for filtering deployments in ArgoCD.
        # At the start of the workflow, we remove the container available labels
        # which will be re-added after the Secure workflow.
        run: gh issue edit $PR_NUMBER --repo ${{ github.repository }} --remove-label "preview-available"
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          PR_NUMBER: ${{ github.event.workflow_run.pull_requests[0].number }}
