name: Visual Regression Start
on:
  workflow_run:
    workflows: [Visual Regression]
    types: [requested]

jobs:
  remove-label:
    runs-on: ubuntu-slim
    if: github.event.workflow_run.event == 'pull_request'
    permissions:
      pull-requests: write
    steps:
      - name: "Remove 'diff-available' label"
        # This label is used for filtering deployments in ArgoCD.
        # At the start of the workflow, we remove the container available labels
        # which will be re-added after the Secure workflow.
        run: gh issue edit $PR_NUMBER --repo ${{ github.repository }} --remove-label "diff-available"
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          PR_NUMBER: ${{ github.event.workflow_run.pull_requests[0].number }}
